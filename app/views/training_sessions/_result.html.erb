<h2>Results</h2>
<div class="result-summary">
  <h3>Accuracy: <span style="<%= session.accuracy_percentage == 100 ? 'color:#10B981' : 'color:#EF4444' %>"><%= session.accuracy_percentage.round(2) %>%</span></h3>
  <p>Time: <%= session.duration_seconds %> seconds</p>
</div>

<% if session.training_type == 'card' %>
  <div class="results-grid">
    <% 
       correct_cards = session.training_data.split(',')
       # Recall data might be empty or partial
       recalled_cards = (session.recall_data || "").split(',')
    %>
    
    <% correct_cards.each_with_index do |correct, i| %>
      <% 
         guessed = recalled_cards[i]
         # Normalize for comparison
         is_correct = guessed && correct && (guessed.upcase == correct.upcase)
         bg_class = is_correct ? "correct-bg" : "incorrect-bg"
      %>
      <div class="result-pair <%= bg_class %>">
        <div class="card-label">Correct</div>
        <%= render_card(correct, width: 80, height: 112) %>
        
        <div class="card-stack-spacer"></div>
        
        <div class="card-label">You</div>
        <% if guessed.present? %>
          <%= render_card(guessed, width: 80, height: 112, opacity: 0.7) %>
        <% else %>
          <div class="missing-card">Missed</div>
        <% end %>
      </div>
    <% end %>
  </div>

<% else %>
  <!-- Number Results (Unchanged) -->
  <h3>Original</h3>
  <div class="data-box"><%= session.training_data %></div>

  <h3>Your Recall</h3>
  <div class="data-box"><%= session.recall_data %></div>
<% end %>

<div style="margin-top: 40px; text-align: center;">
  <%= link_to "Start New Session", new_training_session_path, class: "btn-primary" %>
  <%= link_to "Back to History", training_sessions_path, class: "btn-secondary" %>
</div>

<style>
  .result-summary {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    margin-bottom: 30px;
    text-align: center;
  }
  
  .results-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
  }

  .result-pair {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid rgba(0,0,0,0.1);
    min-width: 100px;
  }

  .correct-bg {
    background-color: #D1FAE5; /* Green 100 */
    border-color: #34D399;
  }

  .incorrect-bg {
    background-color: #FEE2E2; /* Red 100 */
    border-color: #F87171;
  }

  .card-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    font-weight: bold;
    color: #555;
    margin-bottom: 4px;
  }

  .card-stack-spacer { height: 10px; }

  .missing-card {
    width: 80px;
    height: 112px;
    border: 2px dashed #999;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #666;
    font-size: 0.8rem;
    background: rgba(255,255,255,0.5);
  }

  /* Number Styles */
  .data-box {
    padding: 15px;
    background: white;
    border: 1px solid #ccc;
    font-family: monospace;
    word-wrap: break-word;
    border-radius: 8px;
    font-size: 1.2rem;
    letter-spacing: 2px;
  }
</style>